function checkIfArrayHasObjectWithProps(i,t,e){var a=!1,n=null;return i.length&&i.forEach(function(i,o){i[t[0]]==e[0]&&i[t[1]]==e[1]&&(a=!0,n=o)}),{isInArray:a,position:n}}function checkIfArrayHasObjectWithProp(i,t,e){var a=!1,n=null;return i.length&&i.forEach(function(i,o){i[t]==e&&(a=!0,n=o)}),{isInArray:a,position:n}}var storage={target:chrome.storage.local,set:function(i,t){this.target.set(i,t)},get:function(i,t){this.target.get(i,t)}},content={getGeneralRelevance:function(i){storage.get("generalRelevance",i)},getCustomRelevanceDomains:function(i){storage.get("customRelevanceDomains",i)},markAsClickbaitPopover:function(i){var t='<div class="clickbait-blocker-chrome-extension-buttons-wrapper clickbait-mark-js" data-url="'+i.attr("href")+'" style="top: '+(i.offset().top-30)+"px;left: "+i.offset().left+'px"><div class="clickbait-blocker-chrome-extension-mark clickbait-mark-js" data-url="'+i.attr("href")+'"></div>Mark as clickbait</div>';content.removeMarkAsClickbaitPopover(),$("body").append(t).on("mousemove",function(t){content.checkMouseOverTolerance(t,i,"mark")}),setTimeout(function(){$(".clickbait-blocker-chrome-extension-buttons-wrapper").data("data-original-dom-link",i)},100)},mouseOverLink:function(){var i=this;return!(!this.attr("href")||!checkIfUrl(this.attr("href")))&&void content.ifDomainIsNotWhitelisted(content.getPageDomain(),function(){content.markAsClickbaitPopover(i)})},confirmInfirmPopover:function(i){var t='<div class="clickbait-blocker-chrome-extension-reveal-buttons-wrapper" style="top: '+(i.offset().top-45)+"px;left: "+i.offset().left+'px"><div class="clickbait-blocker-chrome-extension-confirm-label">Is this clickbait?</div><div class="clickbait-blocker-chrome-extension-confirm clickbait-confirm clickbait-blocker-chrome-extension-confirm clickbait-confirm-js" data-url="'+i.attr("href")+'"></div><div class="clickbait-blocker-chrome-extension-infirm clickbait-infirm clickbait-blocker-chrome-extension-infirm clickbait-infirm-js" data-url="'+i.attr("href")+'"></div></div>';content.removeConfirmInfirmPopover(),$("body").append(t).on("mousemove",function(t){content.checkMouseOverTolerance(t,i,"confirm")}),setTimeout(function(){$(".clickbait-blocker-chrome-extension-reveal-buttons-wrapper").data("data-original-dom-link",i)},100)},mouseOverRevealedLink:function(){var i=this;content.ifDomainIsNotWhitelisted(content.getPageDomain(),function(){content.confirmInfirmPopover(i)})},mouseOverClickbait:function(){var i=this;content.ifDomainIsNotWhitelisted(content.getPageDomain(),function(){content.revealOriginalLinkPopover(i)})},removeConfirmInfirmPopover:function(){$("body").off("mousemove"),$(".clickbait-blocker-chrome-extension-reveal-buttons-wrapper").remove()},removeMarkAsClickbaitPopover:function(){$("body").off("mousemove"),$(".clickbait-blocker-chrome-extension-buttons-wrapper").remove()},checkMouseOverTolerance:function(i,t,e){var a,n,o=t.offset().left,c=t.width(),r=t.height(),l=t.offset().top;t.children().length>0?(a=t.children().map(function(){return $(this).height()+$(this).offset().top}).get(),n=t.children().map(function(){return $(this).width()+$(this).offset().left}).get(),r=Math.max.apply(null,a),c=Math.max.apply(null,n)):(c+=o,r+=l),i.pageX<o&&o-i.pageX>100?content.determinePopupToRemove(e):i.pageX>o&&i.pageX>100+c?content.determinePopupToRemove(e):i.pageY<l&&l-i.pageY>100?content.determinePopupToRemove(e):i.pageY>l&&i.pageY>100+r&&content.determinePopupToRemove(e)},determinePopupToRemove:function(i){"mark"===i?content.removeMarkAsClickbaitPopover():"reveal"===i?content.removeshowOriginalLinkPopover():"confirm"===i&&content.removeConfirmInfirmPopover()},removeshowOriginalLinkPopover:function(){$("body").off("mousemove"),$(".clickbait-blocker-chrome-extension-reveal-original-wrapper").remove()},getWhitelistedDomains:function(i){storage.get("whitelistedDomains",i)},addDomainToWhitelist:function(i,t){content.getWhitelistedDomains(function(e){e.whitelistedDomains?e.whitelistedDomains.indexOf(i)===-1&&(e.whitelistedDomains.push(i),storage.set({whitelistedDomains:e.whitelistedDomains},t)):storage.set({whitelistedDomains:[i]},t)})},addPredefinedListToWhitelist:function(){var i=["www.google.com","www.google.ro","www.youtube.com","twitter.com","mg.mail.yahoo.com","mail.google.com","stackoverflow.com","github.com","en.wikipedia.com","medium.com","www.bing.com","www.amazon.com","www.reddit.com","www.emag.ro"];content.getWhitelistedDomains(function(t){t.whitelistedDomains&&t.whitelistedDomains.length||storage.set({whitelistedDomains:i})})},ifDomainIsNotWhitelisted:function(i,t){content.getWhitelistedDomains(function(e){e.whitelistedDomains?e.whitelistedDomains.indexOf(i)===-1&&t():t()})},getPageDomain:function(){return window.location.port?window.location.hostname+":"+window.location.port:window.location.hostname},getPageUrl:function(){return window.location.href},anchorHasChildren:function(){return!!this.children().length},anchorHasBackgroundImage:function(){return this.css("background-image").indexOf("url")!==-1},markAsClickBait:function(i){var t=this;content.getClickBaitsMarkedByYou(function(e){function a(){API({url:"https://clickbait-blocker.herokuapp.com/api/clickbait",method:"POST",data:{pageUrl:content.getPageUrl(),pageDomain:content.getPageDomain(),clickBaitLink:$(t).attr("data-url"),upVotes:1,downVotes:0}},i)}var n={domain:content.getPageDomain(),link:$(t).attr("data-url")};e.clickBaitsMarkedByYou&&checkIfArrayHasObjectWithProps(e.clickBaitsMarkedByYou,["domain","link"],[n.domain,n.link]).isInArray?i():a()})},getClickBaitsMarkedByYou:function(i){storage.get("clickBaitsMarkedByYou",i)},addClickBaitMarkedByYou:function(i,t){content.getClickBaitsMarkedByYou(function(e){e.clickBaitsMarkedByYou?checkIfArrayHasObjectWithProps(e.clickBaitsMarkedByYou,["domain","link"],[i.domain,i.link]).isInArray||(e.clickBaitsMarkedByYou.push(i),storage.set({clickBaitsMarkedByYou:e.clickBaitsMarkedByYou},t)):storage.set({clickBaitsMarkedByYou:[i]},t),content.removeInfirmedClickbait(i)})},revealOriginalLink:function(i){var t=i&&$(this)||$(this).parent().data("data-clickbait-dom-link")||$(this).data("data-clickbait-dom-link"),e=t.children().clone();t.attr("href",t.attr("data-original-href")).text(t.attr("data-original-text")).append(e).removeAttr("data-original-text").removeAttr("data-original-href").removeClass("marked-as-clickbait-js clickbait-blocker-chrome-extension text").addClass("clickbait-blocker-chrome-extension marked-as-clickbait-revealed-js"),t.find(".marked-as-clickbait-hidden-js").removeClass("marked-as-clickbait-hidden-js clickbait-blocker-chrome-extension transparent"),t.attr("data-original-background")&&t.css("background-image",t.attr("data-original-background")).removeAttr("data-original-background"),content.removeshowOriginalLinkPopover()},revealOriginalLinkPopover:function(i){var t=$(i).attr("clickbait-upvotes")?'<div title="This is clickbait!" class="clickbait-blocker-chrome-extension-reveal-original-vote clickbait-downvotes"> '+$(i).attr("clickbait-upvotes")+' </div><div title="Not clickbait!" class="clickbait-blocker-chrome-extension-reveal-original-vote clickbait-upvotes"> '+$(i).attr("clickbait-downvotes")+" </div>":"",e='<div class="clickbait-blocker-chrome-extension-reveal-original-wrapper" style="top: '+(i.offset().top-30)+"px;left: "+i.offset().left+'px"><a class="clickbait-blocker-chrome-extension-reveal-original clickbait-reveal-original-js">Show original link</a>'+t+"</div>";content.removeshowOriginalLinkPopover(),$("body").append(e).on("mousemove",function(t){content.checkMouseOverTolerance(t,i,"reveal")}),setTimeout(function(){$(".clickbait-blocker-chrome-extension-reveal-original-wrapper").data("data-clickbait-dom-link",i)},100)},getInfirmedClickbaits:function(i){storage.get("infirmedClickbaits",i)},addInfirmedClickbait:function(i,t){content.getInfirmedClickbaits(function(e){e.infirmedClickbaits?checkIfArrayHasObjectWithProps(e.infirmedClickbaits,["domain","link"],[i.domain,i.link]).isInArray||(e.infirmedClickbaits.push(i),storage.set({infirmedClickbaits:e.infirmedClickbaits},t)):storage.set({infirmedClickbaits:[i]},t)})},removeInfirmedClickbait:function(i){content.getInfirmedClickbaits(function(t){t.infirmedClickbaits&&checkIfArrayHasObjectWithProps(t.infirmedClickbaits,["domain","link"],[i.domain,i.link]).isInArray&&(t.infirmedClickbaits.splice(checkIfArrayHasObjectWithProps(t.infirmedClickbaits,["domain","link"],[i.domain,i.link]).position,1),storage.set({infirmedClickbaits:t.infirmedClickbaits}))})},removeClickBaitMarkedByYou:function(i){content.getClickBaitsMarkedByYou(function(t){t.clickBaitsMarkedByYou&&checkIfArrayHasObjectWithProps(t.clickBaitsMarkedByYou,["domain","link"],[i.domain,i.link]).isInArray&&(t.clickBaitsMarkedByYou.splice(checkIfArrayHasObjectWithProps(t.clickBaitsMarkedByYou,["domain","link"],[i.domain,i.link]).position,1),storage.set({clickBaitsMarkedByYou:t.clickBaitsMarkedByYou}))})},infirmClickBait:function(i){var t=this;content.addInfirmedClickbait({domain:content.getPageDomain(),link:$(t).attr("data-url")},function(){API({url:"https://clickbait-blocker.herokuapp.com/api/clickbait",method:"POST",data:{pageUrl:content.getPageUrl(),pageDomain:content.getPageDomain(),clickBaitLink:$(t).attr("data-url"),upVotes:0,downVotes:1}},i)}),content.removeClickBaitMarkedByYou({domain:content.getPageDomain(),link:$(t).attr("data-url")})},getClickBaits:function(i){var t=content.getPageDomain();content.getGeneralRelevance(function(e){var a=e.generalRelevance||0;content.ifDomainIsNotWhitelisted(t,function(){content.getCustomRelevanceDomains(function(e){e.customRelevanceDomains&&checkIfArrayHasObjectWithProp(e.customRelevanceDomains,"domain",t).isInArray&&(a=e.customRelevanceDomains[checkIfArrayHasObjectWithProp(e.customRelevanceDomains,"domain",t).position].relevance),API({url:"https://clickbait-blocker.herokuapp.com/api/clickbait",method:"GET",data:{pageDomain:t,relevance:a}},i)})})})},hideClickbaits:function(i){function t(i){$('a[href="'+i.clickBaitLink+'"]').each(function(){var t=this;$(t).attr("clickbait-upVotes",i.upVotes).attr("clickbait-downVotes",i.downVotes),content.getClickBaitsMarkedByYou(function(e){e.clickBaitsMarkedByYou&&checkIfArrayHasObjectWithProps(e.clickBaitsMarkedByYou,["domain","link"],[content.getPageDomain(),i.clickBaitLink]).isInArray||content.hideOriginalTitle.call(t,!1,!0)})})}i.forEach(function(i){content.getInfirmedClickbaits(function(e){e.infirmedClickbaits?checkIfArrayHasObjectWithProps(e.infirmedClickbaits,["domain","link"],[content.getPageDomain(),i.clickBaitLink]).isInArray||t(i):t(i)})}),content.getClickBaitsMarkedByYou(function(i){var t=content.getPageDomain();i.clickBaitsMarkedByYou&&checkIfArrayHasObjectWithProp(i.clickBaitsMarkedByYou,"domain",t).isInArray&&i.clickBaitsMarkedByYou.forEach(function(i){$('a[href="'+i.link+'"]').each(function(){content.hideOriginalTitle.call(this,!0,!0)})})})},hideOriginalTitle:function(i,t){var e=i&&"You marked this article as clickbait"||"This article was marked as clickbait",a=t&&$(this)||$(this).parent().data("data-original-dom-link")||$(this).data("data-original-dom-link"),n=a.clone().children().remove().end().text().trim(),o=a.children().clone();a.attr("data-original-href",a.attr("href")).attr("data-original-text",n).attr("href","javascript:;").removeClass("marked-as-clickbait-revealed-js").addClass("marked-as-clickbait-js clickbait-blocker-chrome-extension text"),a.text(e).append(o),content.anchorHasChildren.call(a)&&a.children().each(function(){$(this).addClass("marked-as-clickbait-hidden-js clickbait-blocker-chrome-extension transparent")}),content.anchorHasBackgroundImage.call(a)&&a.attr("data-original-background",a.css("background-image")).css("background-image","")},setTotalClickbaitsOnPage:function(i,t){storage.set(i,t)}},API=function(i,t){var e=i.url||"localhost:3000/api/clickbait",a=i.method||"GET",n=i.data||{};$.ajax({url:e,method:a,data:n,success:function(i){t&&t(i)}})},checkIfUrl=function(i){return!(1===i.length||i.indexOf("javascript:")>=0)};$(function(){content.addPredefinedListToWhitelist(),chrome.runtime.onMessage.addListener(function(i,t,e){if("show_original_titles"===i.action&&$(".marked-as-clickbait-js").each(function(){content.revealOriginalLink.call(this,!0)}),"get_total_clickbaits"===i.action){var a={totalClickbaitsOnPage:$(".marked-as-clickbait-js").length};content.setTotalClickbaitsOnPage(a)}}),content.getClickBaits(function(i){content.hideClickbaits(i)}),$("body").on("mouseover","a:not(.marked-as-clickbait-revealed-js)",function(){content.mouseOverLink.call($(this))}),$("body").on("mouseover",".marked-as-clickbait-js",function(){content.mouseOverClickbait.call($(this))}),$("body").on("mouseover",".marked-as-clickbait-revealed-js",function(){content.mouseOverRevealedLink.call($(this))}),$("body").on("click",function(i){$(i.target).parents(".clickbait-blocker-chrome-extension-buttons-wrapper").length||$(i.target).hasClass("clickbait-blocker-chrome-extension-buttons-wrapper")||content.removeMarkAsClickbaitPopover(),$(i.target).parents(".clickbait-blocker-chrome-extension-reveal-original-wrapper").length||content.removeshowOriginalLinkPopover(),$(i.target).parents(".clickbait-blocker-chrome-extension-reveal-buttons-wrapper").length||content.removeConfirmInfirmPopover()}),$("body").on("click",".clickbait-reveal-original-js",function(){var i=$(this).parent().data("data-clickbait-dom-link").attr("data-original-href");$('a[data-original-href="'+i+'"]').each(function(){content.revealOriginalLink.call(this,!0)})}),$("body").on("click",".clickbait-mark-js",function(i){var t=this,e=t;i.stopPropagation(),$(".clickbait-blocker-chrome-extension-mark").addClass("loading"),content.markAsClickBait.call(t,function(){content.hideOriginalTitle.call(t,!0),content.removeMarkAsClickbaitPopover(),content.addClickBaitMarkedByYou({domain:content.getPageDomain(),link:$(t).attr("data-url")}),$('a[href="'+$(e).attr("data-url")+'"]').each(function(){content.hideOriginalTitle.call(this,!0,!0)})})}),$("body").on("click",".clickbait-confirm-js",function(i){var t=this;$(".clickbait-blocker-chrome-extension-confirm").addClass("loading"),content.markAsClickBait.call(t,function(){$('a[href="'+$(t).attr("data-url")+'"]').each(function(){content.hideOriginalTitle.call(this,!0,!0)}),content.removeConfirmInfirmPopover(),content.addClickBaitMarkedByYou({domain:content.getPageDomain(),link:$(t).attr("data-url")})})}),$("body").on("click",".clickbait-infirm-js",function(i){var t=this;$(".clickbait-blocker-chrome-extension-infirm").addClass("loading"),content.infirmClickBait.call(t,function(){var i=$(t).parent().data("data-original-dom-link");i.removeClass("clickbait-blocker-chrome-extension marked-as-clickbait-revealed-js"),content.removeConfirmInfirmPopover(),$('a[href="'+$(t).attr("data-url")+'"]').not(t).each(function(){$(this).removeClass("clickbait-blocker-chrome-extension marked-as-clickbait-revealed-js")})})})});